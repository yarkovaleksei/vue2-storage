!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t=t||self,e(t.Vue2Storage={}))}(this,function(t){"use strict";function e(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function u(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,u)}c((n=n.apply(t,e||[])).next())})}const r={};class n{get length(){return Object.keys(this.storage).length}get storage(){return r}getItem(t){return t in this.storage?this.storage[t]:null}setItem(t,e){this.storage[t]=e}removeItem(t){t in this.storage&&delete this.storage[t]}clear(){const t=Object.keys(this.storage);for(let e=0;e<=t.length;e++)try{delete this.storage[t[e]]}catch(t){}}}var i,o=new n;!function(t){t.LOCAL="local",t.SESSION="session",t.MEMORY="memory"}(i||(i={}));class s extends Error{constructor(t,e){super(t),this.name="StorageError",e&&(this.stack=e)}}const u=["local","session","memory"];class c{constructor(t={}){this.setOptions(t)}get length(){return this.keys().length}get prefix(){return this.options.prefix}get name(){return"vue2-storage"}get version(){return"6.0.3"}get driver(){switch(this.options.driver){case i.LOCAL:default:return"undefined"!=typeof window?window.localStorage:o;case i.SESSION:return"undefined"!=typeof window?window.sessionStorage:o;case i.MEMORY:return o}}setOptions(t={}){this.checkConfig(t),this.options=Object.freeze({prefix:t.prefix||"app_",driver:t.driver||i.LOCAL,ttl:t.ttl||0,replacer:t.replacer||void 0})}get(t,e=null){try{const r=this.fromJSON(this.addPrefix(t));return null===r?e:r}catch(t){this.throwError(t)}}pull(t,e=null){const r=this.get(t,e);return r!==e&&this.remove(t),r}set(t,e,r={}){try{this.driver.setItem(this.addPrefix(t),this.toJSON(e,r))}catch(t){this.throwError(t)}}remember(t,r,n={}){return e(this,void 0,void 0,function*(){let e=this.get(t,null);if(null!==e)return e;try{return e=yield r(),this.set(t,e,n),e}catch(t){this.throwError(t)}})}remove(t){try{this.driver.removeItem(this.addPrefix(t))}catch(t){this.throwError(t)}}clear(t=!1){try{if(t)this.driver.clear();else{const t=this.keys().filter(t=>t.startsWith(this.options.prefix||""));t.forEach(t=>this.remove(this.removePrefix(t)))}}catch(t){this.throwError(t)}}has(t){return this.removeExpiredValuesByKeys([this.addPrefix(t)]),this.options.driver!==i.MEMORY?this.addPrefix(t)in this.driver:this.addPrefix(t)in this.driver.storage}key(t){try{const e=this.keys()[t];return this.get(this.removePrefix(e))}catch(t){this.throwError(t)}}keys(){let t=[];switch(this.options.driver){case i.MEMORY:t=Object.keys(this.driver.storage);break;default:t=Object.keys(this.driver)}return t.filter(t=>null!==this.fromJSON(t))}checkConfig(t){void 0!==t.prefix&&"string"!=typeof t.prefix&&this.throwError(new TypeError('Option "prefix" must be a string')),void 0!==t.driver&&(u.includes(t.driver)||this.throwError(new TypeError(`Option "driver" must be one of ${u.join(", ")}`))),void 0!==t.ttl&&"number"!=typeof t.ttl&&this.throwError(new TypeError('Option "ttl" must be a number')),void 0!==t.replacer&&"function"!=typeof t.replacer&&this.throwError(new TypeError('Option "replacer" must be a function'))}addPrefix(t){return`${this.options.prefix||""}${this.removePrefix(t)}`}removePrefix(t){const e=new RegExp(`^${this.options.prefix||""}`);return t.replace(e,"")}toJSON(t,e={}){const r="ttl"in e?e.ttl:this.options.ttl,{replacer:replacer}=this.options;return JSON.stringify({value:t,ttl:r>0?r+Date.now():0},(t,e)=>{if(!replacer||"value"!==t)return e;return replacer(t,e)})}fromJSON(t){try{this.removeExpiredValuesByKeys([t]);const e=JSON.parse(this.driver.getItem(t));return null!==e?"value"in e?e.value:e:null}catch(t){return null}}removeExpiredValuesByKeys(t){try{t.forEach(t=>{const e=JSON.parse(this.driver.getItem(t));if(null===e)return;"ttl"in e&&Number(e.ttl)>0&&Number(e.ttl)<Date.now()&&this.remove(this.removePrefix(t))})}catch(t){return null}}throwError(t){throw new s(`${this.name}[${this.version}]: ${t.message}`,t.stack)}}class f{static install(t,e){const r=new c(e);t.$storage=r,t.prototype.$storage=r}}"undefined"!=typeof window&&(window.Vue2StoragePlugin=f,window.Vue2Storage=c),t.Plugin=f,t.default=c,Object.defineProperty(t,"__esModule",{value:!0})});
